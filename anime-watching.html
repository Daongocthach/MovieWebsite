<!DOCTYPE html>
<html lang="zxx">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Anime Template">
    <meta name="keywords" content="Anime, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Stone Movies | Watching</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Css Styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="css/plyr.css" type="text/css">
    <link rel="stylesheet" href="css/nice-select.css" type="text/css">
    <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="css/style.css" type="text/css">
</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Header Section Begin -->
    <header class="header">
        <div class="container">
            <div class="row">
                <div class="col-lg-2">
                    <div class="header__logo">
                        <a href="./index.html">
                            <img src="img/logo.png" alt="">
                        </a>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="header__nav">
                        <nav class="header__menu mobile-menu">
                            <ul>
                                <li><a href="./index.html">Trang chủ</a></li>
                                <li class="active"><a href="#">Thể loại <span class="arrow_carrot-down"></span></a>
                                    <ul class="dropdown">
                                        <li class="dropdown-column">
                                            <a href="./categories.html?slug=hanh-dong">Hành Động</a>
                                            <a href="./categories.html?slug=tinh-cam">Tình Cảm</a>
                                            <a href="./categories.html?slug=hai-huoc">Hài Hước</a>
                                            <a href="./categories.html?slug=co-trang">Cổ Trang</a>
                                            <a href="./categories.html?slug=tam-ly">Tâm Lý</a>
                                            <a href="./categories.html?slug=hinh-su">Hình Sự</a>
                                            <a href="./categories.html?slug=chien-tranh">Chiến Tranh</a>
                                            <a href="./categories.html?slug=the-thao">Thể Thao</a>
                                        </li>
                                        <li class="dropdown-column">
                                            <a href="./categories.html?slug=vo-thuat">Võ Thuật</a>
                                            <a href="./categories.html?slug=vien-tuong">Viễn Tưởng</a>
                                            <a href="./categories.html?slug=phieu-luu">Phiêu Lưu</a>
                                            <a href="./categories.html?slug=khoa-hoc">Khoa Học</a>
                                            <a href="./categories.html?slug=kinh-di">Kinh Dị</a>
                                            <a href="./categories.html?slug=am-nhac">Âm Nhạc</a>
                                            <a href="./categories.html?slug=than-thoai">Thần Thoại</a>
                                            <a href="./categories.html?slug=tai-lieu">Tài Liệu</a>
                                        </li>
                                        <li class="dropdown-column">
                                            <a href="./categories.html?slug=gia-dinh">Gia Đình</a>
                                            <a href="./categories.html?slug=chinh-kich">Chính Kịch</a>
                                            <a href="./categories.html?slug=bi-an">Bí Ẩn</a>
                                            <a href="./categories.html?slug=hoc-duong">Học Đường</a>
                                            <a href="./categories.html?slug=kinh-dien">Kinh Điển</a>
                                            <a href="./categories.html?slug=phim-18">Phim 18+</a>
                                        </li>
                                    </ul>
                                </li>
                                <li><a href="./blog.html">Diễn đàn</a></li>
                                <li><a href="#">Liên hệ</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
                <div class="col-lg-2">
                    <div class="header__right">
                        <a href="#" class="search-switch"><span class="icon_search"></span></a>
                        <a href="./login.html"><span class="icon_profile"></span></a>
                    </div>
                </div>
            </div>
            <div id="mobile-menu-wrap"></div>
        </div>
    </header>
    <!-- Header End -->

    <!-- Breadcrumb Begin -->
    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="./index.html"><i class="fa fa-home"></i> Home</a>
                        <a href="./categories.html">Categories</a>
                        <a href="#">Romance</a>
                        <span>Fate Stay Night: Unlimited Blade</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Anime Section Begin -->
    <section class="anime-details spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="anime__video__player">
                        <video id="video-player" controls width="100%" data-poster="./videos/anime-watch.jpg">
                            <source src="" type="application/x-mpegURL">
                            <track kind="captions" label="English captions" src="#" srclang="en" default />
                            Trình duyệt của bạn không hỗ trợ phát video.
                        </video>
                    </div>
                    <div class="anime__details__episodes">
                        <div class="section-title">
                            <h5>List Name</h5>
                        </div>
                        <div id="episodeList"></div>
                    </div>
                </div>
            </div>
            <!-- <div class="row">
                <div class="col-lg-12">
                    <div class="anime__video__player">
                        <video id="player" playsinline controls data-poster="./videos/anime-watch.jpg">
                            <source src="videos/1.mp4" type="video/mp4" />
                            <track kind="captions" label="English captions" src="#" srclang="en" default />
                        </video>
                    </div>
                    <div class="anime__details__episodes">
                        <div class="section-title">
                            <h5>List Name</h5>
                        </div>
                        <a href="#">Ep 01</a>
                        <a href="#">Ep 02</a>
                        <a href="#">Ep 03</a>
                        <a href="#">Ep 04</a>
                        <a href="#">Ep 05</a>
                        <a href="#">Ep 06</a>
                        <a href="#">Ep 07</a>
                        <a href="#">Ep 08</a>
                        <a href="#">Ep 09</a>
                        <a href="#">Ep 10</a>
                        <a href="#">Ep 11</a>
                        <a href="#">Ep 12</a>
                        <a href="#">Ep 13</a>
                        <a href="#">Ep 14</a>
                        <a href="#">Ep 15</a>
                        <a href="#">Ep 16</a>
                        <a href="#">Ep 17</a>
                        <a href="#">Ep 18</a>
                        <a href="#">Ep 19</a>
                    </div>
                </div>
            </div> -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="anime__details__review">
                        <div class="section-title">
                            <h5>Reviews</h5>
                        </div>
                        <div class="anime__review__item">
                            <div class="anime__review__item__pic">
                                <img src="img/anime/review-1.jpg" alt="">
                            </div>
                            <div class="anime__review__item__text">
                                <h6>Chris Curry - <span>1 Hour ago</span></h6>
                                <p>whachikan Just noticed that someone categorized this as belonging to the genre
                                    "demons" LOL</p>
                            </div>
                        </div>
                    </div>
                    <div class="anime__details__form">
                        <div class="section-title">
                            <h5>Your Comment</h5>
                        </div>
                        <form action="#">
                            <textarea placeholder="Your Comment"></textarea>
                            <button type="submit"><i class="fa fa-location-arrow"></i> Review</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Anime Section End -->

    <!-- Footer Section Begin -->
    <footer class="footer">
        <div class="page-up">
            <a href="#" id="scrollToTopButton"><span class="arrow_carrot-up"></span></a>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="footer__logo">
                        <a href="./index.html"><img src="img/logo.png" alt=""></a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="footer__nav">
                        <ul>
                            <li class="active"><a href="./index.html">Homepage</a></li>
                            <li><a href="./categories.html">Categories</a></li>
                            <li><a href="./blog.html">Our Blog</a></li>
                            <li><a href="#">Contacts</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3">
                    <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        Copyright &copy;
                        <script>document.write(new Date().getFullYear());</script> All rights reserved | This template
                        is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com"
                            target="_blank">Colorlib</a>
                        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    </p>

                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Search model Begin -->
    <div class="search-model">
        <div class="h-100 d-flex align-items-center justify-content-center">
            <div class="search-close-switch"><i class="icon_close"></i></div>
            <form class="search-model-form">
                <input type="text" id="search-input" placeholder="Search here.....">
            </form>
        </div>
    </div>
    <!-- Search model end -->

    <!-- Js Plugins -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/player.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/mixitup.min.js"></script>
    <script src="js/jquery.slicknav.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        function loadVideo(url) {
            const videoPlayer = document.getElementById("video-player");
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(videoPlayer);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    videoPlayer.play();
                });
            } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                // Trình duyệt hỗ trợ HLS (chủ yếu là Safari)
                videoPlayer.src = url;
                videoPlayer.addEventListener("loadedmetadata", () => {
                    videoPlayer.play();
                });
            } else {
                console.error("Trình duyệt không hỗ trợ phát tệp HLS.");
            }
        }
        async function fetchMovieDetails(slug) {
            try {
                // Gửi request tới API
                const response = await fetch(`https://ophim1.com/phim/${slug}`);
                const data = await response.json();

                if (!data.status) {
                    throw new Error("Không lấy được dữ liệu từ API.");
                }

                const movie = data.movie;
                const episodes = data.episodes[0]?.server_data;
                const firstEpisodeUrl = episodes[0]?.link_m3u8;

                if (firstEpisodeUrl) {
                    loadVideo(firstEpisodeUrl);
                } else {
                    console.warn("Không có tập phim nào.");
                }

                // Hiển thị danh sách tập phim
                const episodeListDiv = document.getElementById("episodeList");
                const urlParams = new URLSearchParams(window.location.search);
                const currentSlug = urlParams.get("slug"); // Lấy slug từ URL
                const currentEpisode = urlParams.get("episode"); // Lấy episode từ URL

                episodes.forEach((episode, index) => {
                    const episodeLink = document.createElement("a");
                    // Sửa lại href để truyền đúng các tham số slug và episode
                    episodeLink.href = `./anime-watching.html?slug=${movie.slug}&episode=${episode.slug}`;
                    episodeLink.textContent = `Ep ${index + 1}`;

                    // Kiểm tra xem episode này có phải là episode hiện tại không
                    if (episode.slug === currentEpisode) {
                        // Nếu đúng, thêm lớp CSS để highlight
                        episodeLink.classList.add("highlight");
                    }

                    episodeLink.addEventListener("click", (event) => {
                        // event.preventDefault(); // Ngừng chuyển hướng nếu bạn chỉ muốn load video
                        loadVideo(episode.link_m3u8); // Gọi hàm load video
                    });

                    episodeListDiv.appendChild(episodeLink);
                });

                // Cấu hình lớp CSS để làm sáng episode hiện tại
                const style = document.createElement("style");
                style.innerHTML = `
                    .highlight {
                        font-weight: bold;
                        font-size: 20px;
                        color: #123;
                        text-decoration: underline;
                    }
                `;
                document.head.appendChild(style);
            } catch (error) {
                console.error("Lỗi:", error.message);
            }
        }

        // Function to get slug from URL
        function getSlugFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get("slug");
        }

        // Run fetchData on page load
        document.addEventListener("DOMContentLoaded", function () {
            const slug = getSlugFromUrl();
            if (slug) {
                fetchMovieDetails(slug);
            } else {
                console.warn("Không tìm thấy slug trong URL.");
            }
        });
    </script>
</body>

</html>